const D=(e,t)=>t.some(n=>e instanceof n);let g,E;function L(){return g||(g=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function C(){return E||(E=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const l=new WeakMap,y=new WeakMap,w=new WeakMap;function N(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",c)},s=()=>{n(u(e.result)),o()},c=()=>{r(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",c)});return w.set(t,e),t}function j(e){if(l.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",c),e.removeEventListener("abort",c)},s=()=>{n(),o()},c=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",c),e.addEventListener("abort",c)});l.set(e,t)}let I={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return l.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return u(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function P(e){I=e(I)}function O(e){return C().includes(e)?function(...t){return e.apply(m(this),t),u(this.request)}:function(...t){return u(e.apply(m(this),t))}}function T(e){return typeof e=="function"?O(e):(e instanceof IDBTransaction&&j(e),D(e,L())?new Proxy(e,I):e)}function u(e){if(e instanceof IDBRequest)return N(e);if(y.has(e))return y.get(e);const t=T(e);return t!==e&&(y.set(e,t),w.set(t,e)),t}const m=e=>w.get(e);function p(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const c=indexedDB.open(e,t),f=u(c);return r&&c.addEventListener("upgradeneeded",i=>{r(u(c.result),i.oldVersion,i.newVersion,u(c.transaction),i)}),n&&c.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),f.then(i=>{s&&i.addEventListener("close",()=>s()),o&&i.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),f}const V=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],h=new Map;function M(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(h.get(t))return h.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||V.includes(n)))return;const s=async function(c,...f){const i=this.transaction(c,o?"readwrite":"readonly");let d=i.store;return r&&(d=d.index(f.shift())),(await Promise.all([d[n](...f),o&&i.done]))[0]};return h.set(t,s),s}P(e=>({...e,get:(t,n,r)=>M(t,n)||e.get(t,n,r),has:(t,n)=>!!M(t,n)||e.has(t,n)}));const F=["continue","continuePrimaryKey","advance"],x={},b=new WeakMap,S=new WeakMap,W={get(e,t){if(!F.includes(t))return e[t];let n=x[t];return n||(n=x[t]=function(...r){b.set(this,S.get(this)[t](...r))}),n}};async function*k(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,W);for(S.set(n,t),w.set(n,m(t));t;)yield n,t=await(b.get(n)||t.continue()),b.delete(n)}function A(e,t){return t===Symbol.asyncIterator&&D(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&D(e,[IDBIndex,IDBObjectStore])}P(e=>({...e,get(t,n,r){return A(t,n)?k:e.get(t,n,r)},has(t,n){return A(t,n)||e.has(t,n)}}));const K="notesDB",a="notes",B=async()=>p(K,2,{upgrade(e){e.objectStoreNames.contains(a)||e.createObjectStore(a,{keyPath:"id",autoIncrement:!0}).createIndex("createdAt","createdAt",{unique:!1})}}),R=async e=>{const n=(await B()).transaction(a,"readwrite"),r=n.objectStore(a),o=await r.get(e.id),s=JSON.parse(JSON.stringify(e));o?s.createdAt=o.createdAt:s.createdAt=Date.now(),await r.put(s),await n.done},J=async()=>(await(await B()).transaction(a,"readonly").objectStore(a).getAll()).sort((o,s)=>s.createdAt-o.createdAt),_=async e=>{const n=(await B()).transaction(a,"readwrite");await n.objectStore(a).delete(e),await n.done};export{_ as d,J as g,R as s};
